<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>NeuroNav-NanoTwin ‚Ä¢ Nanorrobots magneto-guiados</title>
<style>
  :root{
    --bg:#0b1020;
    --panel:#111827;
    --card:rgba(255,255,255,.06);
    --b:rgba(255,255,255,.12);
    --txt:#e9ecff;
    --mut:rgba(233,236,255,.78);
    --acc:#38bdf8;
    --acc2:#a78bfa;
    --r:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,system-ui;background:var(--bg);color:var(--txt)}
  header{
    padding:22px 14px;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border-bottom:1px solid rgba(255,255,255,.10);
    text-align:center;
  }
  h1{margin:0;font-size:22px;line-height:1.25}
  .sub{margin:8px 0 0;color:var(--mut);font-size:13px;line-height:1.4}
  .wrap{padding:18px 12px 26px;max-width:1200px;margin:0 auto}
  .tagrow{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  .tag{
    font-size:12px;color:var(--mut);
    padding:7px 10px;border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
  }
  .sim-box{
    width:100%;
    margin:16px auto;
    border:2px solid rgba(56,189,248,.35);
    border-radius:18px;
    overflow:hidden;
    background:#000;
    box-shadow:0 10px 40px rgba(0,0,0,.35);
  }
  iframe{width:100%;height:620px;border:0;display:block}
  .grid2{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;align-items:start}
  .card{
    background:var(--card);
    border:1px solid var(--b);
    border-radius:18px;
    padding:14px;
  }
  h2{margin:0 0 10px;font-size:16px}
  p{margin:8px 0;color:var(--mut);font-size:13px;line-height:1.45}
  .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .kpi{
    background:rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:10px;
    min-height:64px;
  }
  .kpi div{font-size:12px;color:var(--mut)}
  .kpi b{font-size:16px}
  #diag{
    font-weight:900;margin:12px 0 6px;
    padding:10px 12px;border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.22);
  }
  ul{margin:8px 0 0;padding-left:18px;color:var(--mut);font-size:13px}
  .mini{font-size:12px;color:rgba(233,236,255,.65)}
  footer{
    padding:12px;background:rgba(255,255,255,.04);
    border-top:1px solid rgba(255,255,255,.10);
    text-align:center;font-size:13px;color:rgba(233,236,255,.72)
  }
  @media(max-width:980px){
    .grid2{grid-template-columns:1fr}
    iframe{height:660px}
    .kpis{grid-template-columns:1fr 1fr}
  }
</style>
</head>
  <!-- ‚úÖ Tutorial flotante (TOQUE FINAL) -->
<div id="tour" style="
  position:fixed; left:18px; bottom:18px; z-index:9999;
  max-width:360px; padding:14px 14px 10px;
  background:rgba(15,23,42,.92); color:#e9ecff;
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px; backdrop-filter: blur(8px);
  font-family:Arial; box-shadow:0 10px 35px rgba(0,0,0,.45);
">
  <div style="font-weight:900; font-size:14px; margin-bottom:6px">
    üß≠ Modo tutorial (r√°pido)
  </div>
  <ol style="margin:0; padding-left:18px; font-size:13px; line-height:1.35; opacity:.95">
    <li>Presiona <b>üíâ Inyectar</b> dentro de la simulaci√≥n.</li>
    <li>Sube <b>Campo magn√©tico</b> para dirigir nanorobots.</li>
    <li>Aumenta <b>Permeabilidad BBB</b> para facilitar el cruce.</li>
    <li>Usa <b>Pulsos</b> y <b>Liberaci√≥n</b> y mira las m√©tricas.</li>
  </ol>
  <div style="display:flex; gap:8px; margin-top:10px">
    <button id="tourHide" style="
      flex:1; padding:9px 10px; border-radius:12px; cursor:pointer;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08); color:#e9ecff; font-weight:900
    ">Ocultar</button>
    <button id="tourShow" style="
      flex:1; padding:9px 10px; border-radius:12px; cursor:pointer;
      border:1px solid rgba(56,189,248,.35);
      background:rgba(56,189,248,.12); color:#e9ecff; font-weight:900;
      display:none
    ">Mostrar</button>
  </div>
</div>

<script>
  const tour = document.getElementById("tour");
  const hideBtn = document.getElementById("tourHide");
  const showBtn = document.getElementById("tourShow");

  hideBtn.addEventListener("click", () => {
    // deja solo un botoncito para mostrar de nuevo
    tour.style.maxWidth = "170px";
    tour.querySelector("ol").style.display = "none";
    tour.querySelector("div").textContent = "üß≠ Tutorial oculto";
    hideBtn.style.display = "none";
    showBtn.style.display = "block";
  });

  showBtn.addEventListener("click", () => {
    tour.style.maxWidth = "360px";
    tour.querySelector("div").textContent = "üß≠ Modo tutorial (r√°pido)";
    tour.querySelector("ol").style.display = "block";
    showBtn.style.display = "none";
    hideBtn.style.display = "block";
  });
</script>
<!-- üö® ALERTA GLOBAL AUTOM√ÅTICA (sin editar tu c√≥digo existente) -->
<div id="ALERTA_GLOBAL_RIESGO" style="
  position:fixed; inset:0; z-index:999999;
  display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.70); backdrop-filter: blur(8px);
">
  <div style="
    width:min(900px,92%);
    background:rgba(15,23,42,.96);
    border:3px solid rgba(251,113,133,.95);
    border-radius:22px;
    padding:22px 18px;
    text-align:center;
    color:#fff;
    font-family:Arial;
    box-shadow:0 25px 90px rgba(0,0,0,.65);
  ">
    <div style="font-size:44px; font-weight:900; line-height:1;">
      ‚ö†Ô∏è ALERTA DE RIESGO
    </div>
    <div id="ALERTA_GLOBAL_MSG" style="margin-top:10px; font-size:18px; opacity:.95; line-height:1.35;">
      Se detect√≥ un nivel de riesgo alto en la simulaci√≥n.
    </div>

    <div style="margin-top:16px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button id="ALERTA_GLOBAL_CERRAR" style="
        padding:12px 18px; border-radius:14px; cursor:pointer;
        border:1px solid rgba(255,255,255,.22);
        background:rgba(255,255,255,.10);
        color:#fff; font-weight:900; font-size:16px;
      ">Cerrar</button>

      <button id="ALERTA_GLOBAL_OCULTAR_30" style="
        padding:12px 18px; border-radius:14px; cursor:pointer;
        border:1px solid rgba(56,189,248,.45);
        background:rgba(56,189,248,.14);
        color:#e9ecff; font-weight:900; font-size:16px;
      ">Ocultar 30s</button>
    </div>

    <div style="margin-top:10px; font-size:12px; opacity:.70;">
      Se activa autom√°ticamente cuando aparece ‚ÄúRiesgo alto‚Äù o toxicidad alta.
    </div>
  </div>
</div>

<script>
(() => {
  const overlay = document.getElementById("ALERTA_GLOBAL_RIESGO");
  const msgEl   = document.getElementById("ALERTA_GLOBAL_MSG");
  const btnX    = document.getElementById("ALERTA_GLOBAL_CERRAR");
  const btn30   = document.getElementById("ALERTA_GLOBAL_OCULTAR_30");

  let mutedUntil = 0;

  function show(msg){
    if(Date.now() < mutedUntil) return;
    msgEl.textContent = msg || "Se detect√≥ un nivel de riesgo alto en la simulaci√≥n.";
    overlay.style.display = "flex";
  }
  function hide(){ overlay.style.display = "none"; }

  btnX.onclick  = hide;
  btn30.onclick = () => { mutedUntil = Date.now() + 30000; hide(); };

  // ‚úÖ 1) ACTIVACI√ìN POR TEXTO ‚ÄúRIESGO ALTO‚Äù EN LA P√ÅGINA (no depende del juego)
  const watchForRiskText = () => {
    if(Date.now() < mutedUntil) return;

    // Busca el texto tal como aparece en tu panel
    const txt = document.body?.innerText || "";
    if (txt.includes("Riesgo alto") || txt.includes("RIESGO ALTO")) {
      show("‚ö†Ô∏è Riesgo alto detectado: demasiada exposici√≥n fuera del tumor. Baja 'Fuga fuera del objetivo' y/o sube 'Aclaramiento'.");
    }
  };

  // Revisa cada 500 ms
  setInterval(watchForRiskText, 500);

  // ‚úÖ 2) ACTIVACI√ìN POR M√âTRICAS DEL JUEGO (si manda NANO_METRICS)
  const TOX_THRESHOLD = 65; // cambia si quieres (ej. 50, 70, 80)
  window.addEventListener("message", (e) => {
    if(!e.data || e.data.type !== "NANO_METRICS") return;
    const m = e.data.payload || {};
    const tox = Number(m.toxicity ?? 0);

    if(tox >= TOX_THRESHOLD){
      show(`‚ö†Ô∏è Toxicidad alta detectada (${Math.round(tox)}%). Hay exposici√≥n en tejido sano. Ajusta fuga/aclaramiento.`);
    }
  });

})();
</script>

<body>
<!-- ‚úÖ Fondo animado laboratorio (corregido: queda detr√°s) -->
<canvas id="labBG" aria-hidden="true"></canvas>

<style>
  /* Fondo */
  #labBG{
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: -1;          /* ‚úÖ detr√°s de todo */
    pointer-events: none; /* ‚úÖ no bloquea clicks */
    display: block;
  }

  /* ‚úÖ Asegura que TODO tu contenido quede encima */
  body{ position: relative; z-index: 0; }
  header, main, section, footer, .wrap, .container, .panel, .sim-box{
    position: relative;
    z-index: 1;
  }
</style>

<script>
(() => {
  const c = document.getElementById("labBG");
  const ctx = c.getContext("2d");

  function resize(){
    const dpr = window.devicePixelRatio || 1;
    c.width  = Math.floor(window.innerWidth  * dpr);
    c.height = Math.floor(window.innerHeight * dpr);
  }
  window.addEventListener("resize", resize);
  resize();

  const N = 90;
  const pts = Array.from({length:N}, () => ({
    x: Math.random()*c.width,
    y: Math.random()*c.height,
    r: (1.2 + Math.random()*2.2) * (window.devicePixelRatio || 1),
    vx: (-0.25 + Math.random()*0.5) * (window.devicePixelRatio || 1),
    vy: (-0.25 + Math.random()*0.5) * (window.devicePixelRatio || 1),
    a: 0.18 + Math.random()*0.25
  }));

  function step(){
    ctx.clearRect(0,0,c.width,c.height);

    // glow suave
    const g = ctx.createRadialGradient(c.width*0.2,c.height*0.2,10,c.width*0.2,c.height*0.2, c.width*0.8);
    g.addColorStop(0,"rgba(56,189,248,0.06)");
    g.addColorStop(1,"rgba(167,139,250,0.02)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,c.width,c.height);

    const dpr = window.devicePixelRatio || 1;

    // l√≠neas
    for(let i=0;i<N;i++){
      for(let j=i+1;j<N;j++){
        const dx = pts[i].x-pts[j].x;
        const dy = pts[i].y-pts[j].y;
        const d = Math.hypot(dx,dy);
        if(d < 160*dpr){
          const alpha = (1 - d/(160*dpr)) * 0.10;
          ctx.strokeStyle = `rgba(56,189,248,${alpha})`;
          ctx.lineWidth = 1*dpr;
          ctx.beginPath();
          ctx.moveTo(pts[i].x, pts[i].y);
          ctx.lineTo(pts[j].x, pts[j].y);
          ctx.stroke();
        }
      }
    }

    // part√≠culas
    for(const p of pts){
      p.x += p.vx; p.y += p.vy;
      if(p.x<0) p.x=c.width;
      if(p.x>c.width) p.x=0;
      if(p.y<0) p.y=c.height;
      if(p.y>c.height) p.y=0;

      ctx.fillStyle = `rgba(233,236,255,${p.a})`;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    }

    requestAnimationFrame(step);
  }
  step();
})();
</script>
<header>
  <h1>Optimizaci√≥n de la liberaci√≥n dirigida de f√°rmacos en tumores cerebrales mediante nanorrobots magneto-guiados y un gemelo digital con IA</h1>
  <div class="sub">NeuroNav-NanoTwin ‚Ä¢ Navegaci√≥n + Liberaci√≥n controlada ‚Ä¢ Modelo educativo (2D simplificado)</div>
  <div class="tagrow">
    <span class="tag">BBB (barrera hematoencef√°lica)</span>
    <span class="tag">Gu√≠a magn√©tica</span>
    <span class="tag">Difusi√≥n + Convecci√≥n</span>
    <span class="tag">AUC tumor vs tejido sano</span>
  </div>
</header>

<div class="wrap">
  <div class="sim-box">
    <!-- cache-buster para que GitHub Pages no muestre versi√≥n vieja -->
    <iframe src="./juegos/nanorobots.html?v=2026"></iframe>
  </div>

  <div class="grid2">
    <div class="card">
      <h2>C√≥mo leer la simulaci√≥n (simple)</h2>
      <p><b>1)</b> Presiona <b>üíâ Inyectar</b>. Los nanorrobots aparecen en el vaso sangu√≠neo.</p>
      <p><b>2)</b> Ajusta el <b>campo magn√©tico</b> y la <b>permeabilidad de la BBB</b> para que m√°s nanorrobots crucen hacia el tumor.</p>
      <p><b>3)</b> Ajusta <b>pulsos</b> y <b>tasa de liberaci√≥n</b> para subir <b>AUC en tumor</b> y bajar <b>exposici√≥n en tejido sano</b>.</p>
      <p class="mini">Nota: es un modelo 2D educativo. No representa valores cl√≠nicos reales, solo relaciones biof√≠sicas.</p>
    </div>

    <div class="card">
      <h2>Conclusiones autom√°ticas</h2>

      <div class="kpis">
        <div class="kpi"><div>Llega al tumor</div><b id="kReach">--</b></div>
        <div class="kpi"><div>AUC tumor (sim.)</div><b id="kTumDose">--</b></div>
        <div class="kpi"><div>Exposici√≥n sana</div><b id="kTox">--</b></div>
        <div class="kpi"><div>Control tumoral</div><b id="kCtrl">--</b></div>
      </div>

      <div id="diag">Esperando datos‚Ä¶</div>
      <ul id="points"></ul>
      <p id="tip" style="margin-top:10px;font-weight:800"></p>
    </div>
  </div>
</div>

<footer>Proyecto de Biof√≠sica ‚Ä¢ NeuroNav-NanoTwin ‚Ä¢ 2026</footer>

<script>
const el = (id)=>document.getElementById(id);

function setPoints(arr){
  el("points").innerHTML = arr.map(x=>"<li>"+x+"</li>").join("");
}

window.addEventListener("message",(e)=>{
  if(!e.data || e.data.type !== "NANO_METRICS") return;
  const m = e.data.payload || {};

  // Compatibles con lo que ya ten√≠as:
  const reach = Number(m.reachPct ?? 0);
  const aucTum = Number(m.doseTumor ?? 0);
  const tox = Number(m.toxicity ?? 0);
  const ctrl = Number(m.tumorPct ?? 0); // aqu√≠ lo usamos como "Control tumoral (%)"

  el("kReach").textContent = Math.round(reach) + "%";
  el("kTumDose").textContent = aucTum.toFixed(1);
  el("kTox").textContent = Math.round(tox) + "%";
  el("kCtrl").textContent = Math.round(ctrl) + "%";

  let diag = "üü® Configuraci√≥n mejorable";
  if(ctrl >= 75 && tox <= 30) diag = "‚úÖ Excelente: alta eficacia con baja exposici√≥n sana";
  else if(ctrl >= 60 && tox <= 45) diag = "üü¶ Buena: balance razonable";
  else if(tox >= 70) diag = "‚ö†Ô∏è Riesgo alto: demasiada exposici√≥n fuera del tumor";

  el("diag").textContent = diag;

  const pts = [];
  if(reach < 40) pts.push("Pocos nanorrobots alcanzan el tumor: sube campo magn√©tico o permeabilidad BBB.");
  else pts.push("Buen transporte hacia el tumor (navegaci√≥n efectiva).");

  if(aucTum < 35) pts.push("AUC tumoral baja: sube pulsos/liberaci√≥n local o adhesi√≥n.");
  else pts.push("AUC tumoral adecuada: liberaci√≥n localizada efectiva.");

  if(tox > 50) pts.push("Exposici√≥n en tejido sano alta: baja tasa fuera-objetivo o aumenta liberaci√≥n solo en tumor.");
  else pts.push("Exposici√≥n sana controlada.");

  setPoints(pts);

  el("tip").textContent =
    "Tip r√°pido: aumenta gu√≠a magn√©tica + BBB controlada y usa pulsos cortos para liberar solo dentro del tumor.";
});
</script>

</body>
</html>




