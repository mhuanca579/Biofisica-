<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NeuroNav-NanoTwin â€¢ SimulaciÃ³n (Sangre + BBB + GuÃ­a)</title>
<style>
  :root{
    --bg:#050814; --txt:#e9ecff; --mut:rgba(233,236,255,.75);
    --b:rgba(255,255,255,.12); --acc:#38bdf8; --acc2:#a78bfa;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--txt);font-family:Arial;overflow:hidden}
  .wrap{display:grid;grid-template-columns:390px 1fr;height:100vh}
  aside{padding:14px;border-right:1px solid rgba(255,255,255,.10);
        background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));overflow:auto}
  h2{margin:0 0 6px;font-size:18px}
  .hint{font-size:12px;color:var(--mut);line-height:1.35;margin-bottom:10px}
  label{display:block;margin:10px 0 6px;color:var(--mut);font-size:12px}
  .val{float:right;font-weight:900;color:rgba(233,236,255,.9)}
  input[type="range"],select{width:100%}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  button{
    flex:1;min-width:120px;border:1px solid var(--b);
    background:rgba(255,255,255,.06);color:var(--txt);padding:10px;border-radius:12px;
    cursor:pointer;font-weight:900
  }
  button.primary{border-color:rgba(56,189,248,.35);background:rgba(56,189,248,.12)}
  .kpis{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .kpi{border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);border-radius:14px;padding:10px}
  .kpi div{font-size:12px;color:var(--mut)}
  .kpi b{font-size:18px}
  main{padding:12px}
  canvas{width:100%;display:block;border-radius:16px;background:#000;border:2px solid rgba(56,189,248,.35)}
  .legend{margin-top:10px;font-size:12px;color:var(--mut);line-height:1.35}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);
        background:rgba(255,255,255,.06)}
  @media(max-width:980px){body{overflow:auto}.wrap{grid-template-columns:1fr;height:auto}}
</style>
</head>
<body>

<div class="wrap">
  <aside>
    <h2>NeuroNav-NanoTwin</h2>
    <div class="hint">
      <b>CÃ³mo leerlo:</b> Arriba = <b>sangre</b> ðŸ©¸, lÃ­nea punteada = <b>BBB</b>, abajo = <b>cerebro</b> ðŸ§  y cÃ­rculo = <b>tumor</b> ðŸŽ¯.
      <br>1) Inyectas â†’ 2) Viajan en sangre â†’ 3) Cruzan BBB â†’ 4) Llegan al tumor â†’ 5) Liberan con pulsos.
    </div>

    <label>Tipo de nanorrobot</label>
    <select id="type">
      <option value="mag">Magneto-guiado (principal)</option>
      <option value="lig">Ligandos (afinidad bioquÃ­mica)</option>
      <option value="mix">HÃ­brido (mag + ligandos)</option>
    </select>

    <label>Dosis <span class="val" id="vDose">240</span></label>
    <input id="dose" type="range" min="80" max="520" step="1" value="240">

    <label>Flujo sanguÃ­neo <span class="val" id="vFlow">1.3</span></label>
    <input id="flow" type="range" min="0.6" max="2.6" step="0.1" value="1.3">

    <label>Campo magnÃ©tico (guÃ­a) <span class="val" id="vB">65</span></label>
    <input id="B" type="range" min="0" max="100" step="1" value="65">

    <label>Permeabilidad BBB (apertura) <span class="val" id="vBBB">35</span></label>
    <input id="bbb" type="range" min="0" max="100" step="1" value="35">

    <label>Pulsos (cuÃ¡ndo liberar) <span class="val" id="vPulse">50</span></label>
    <input id="pulse" type="range" min="0" max="100" step="1" value="50">

    <label>LiberaciÃ³n en tumor <span class="val" id="vRel">55</span></label>
    <input id="rel" type="range" min="0" max="100" step="1" value="55">

    <label>Fuga fuera objetivo <span class="val" id="vLeak">18</span></label>
    <input id="leak" type="range" min="0" max="100" step="1" value="18">

    <label>Aclaramiento (hÃ­gado/riÃ±Ã³n) <span class="val" id="vClear">25</span></label>
    <input id="clear" type="range" min="0" max="100" step="1" value="25">

    <div class="row">
      <button id="inject" class="primary">ðŸ’‰ Inyectar</button>
      <button id="boost">âž• Refuerzo</button>
      <button id="reset">ðŸ”„ Reiniciar</button>
    </div>

    <div class="kpis">
      <div class="kpi"><div>% llega al tumor</div><b id="kReach">0%</b></div>
      <div class="kpi"><div>FÃ¡rmaco en tumor</div><b id="kAUCT">0.0</b></div>
      <div class="kpi"><div>ExposiciÃ³n sana</div><b id="kTox">0%</b></div>
      <div class="kpi"><div>Control tumoral</div><b id="kCtrl">85%</b></div>
    </div>

    <div class="hint" id="status" style="margin-top:10px">Estado: esperando inyecciÃ³n.</div>

    <div class="legend">
      <span class="pill">Azul</span> con fÃ¡rmaco Â·
      <span class="pill">Amarillo</span> descargados Â·
      <span class="pill">BBB</span> barrera Â·
      Heatmap: brillo = fÃ¡rmaco en tumor
    </div>
  </aside>

  <main>
    <canvas id="cv" width="1200" height="720"></canvas>
  </main>
</div>

<script>
/* ====== Setup ====== */
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");

const ui = {
  type: document.getElementById("type"),
  dose: document.getElementById("dose"),
  flow: document.getElementById("flow"),
  B: document.getElementById("B"),
  bbb: document.getElementById("bbb"),
  pulse: document.getElementById("pulse"),
  rel: document.getElementById("rel"),
  leak: document.getElementById("leak"),
  clear: document.getElementById("clear"),
  vDose: document.getElementById("vDose"),
  vFlow: document.getElementById("vFlow"),
  vB: document.getElementById("vB"),
  vBBB: document.getElementById("vBBB"),
  vPulse: document.getElementById("vPulse"),
  vRel: document.getElementById("vRel"),
  vLeak: document.getElementById("vLeak"),
  vClear: document.getElementById("vClear"),
  inject: document.getElementById("inject"),
  boost: document.getElementById("boost"),
  reset: document.getElementById("reset"),
  kReach: document.getElementById("kReach"),
  kAUCT: document.getElementById("kAUCT"),
  kTox: document.getElementById("kTox"),
  kCtrl: document.getElementById("kCtrl"),
  status: document.getElementById("status")
};

const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
const rand=(a,b)=>a+Math.random()*(b-a);

/* ====== UI labels ====== */
function sync(){
  ui.vDose.textContent=ui.dose.value;
  ui.vFlow.textContent=ui.flow.value;
  ui.vB.textContent=ui.B.value;
  ui.vBBB.textContent=ui.bbb.value;
  ui.vPulse.textContent=ui.pulse.value;
  ui.vRel.textContent=ui.rel.value;
  ui.vLeak.textContent=ui.leak.value;
  ui.vClear.textContent=ui.clear.value;
}
["input","change"].forEach(ev=>{
  [ui.dose,ui.flow,ui.B,ui.bbb,ui.pulse,ui.rel,ui.leak,ui.clear].forEach(el=>el.addEventListener(ev,sync));
});
sync();

/* ====== Zones ====== */
const blood = {x:70,y:110,w:cv.width-140,h:240,r:26};
const bbbLineY = blood.y + blood.h + 35;
const brain = {x:70,y:bbbLineY+25,w:cv.width-140,h:cv.height-(bbbLineY+45),r:26};
const tumor = {x:cv.width-290, y:brain.y+brain.h*0.55, r:95};

/* ====== Heatmap ====== */
const HM=32;
let hm = new Float32Array(HM*HM);
const hidx=(i,j)=>i*HM+j;

function hmCell(x,y){
  const rx=(x-(tumor.x-tumor.r))/(tumor.r*2);
  const ry=(y-(tumor.y-tumor.r))/(tumor.r*2);
  const j=clamp(Math.floor(rx*HM),0,HM-1);
  const i=clamp(Math.floor(ry*HM),0,HM-1);
  return {i,j};
}

/* ====== State ====== */
let bots=[], total=0, arrived=0;
let aucTum=0, aucSano=0;
let ctrl=85;
let mode="idle"; // idle | inject | sim

// injection animation
let injT=0;
let needle={x:200,y:-160, plunger:0};

/* ====== Model multipliers by type ====== */
function typeMul(){
  const t=ui.type.value;
  if(t==="mag") return {guide:1.25, bind:1.00, leak:1.00};
  if(t==="lig") return {guide:0.85, bind:1.25, leak:0.95};
  return {guide:1.15, bind:1.15, leak:1.05};
}

/* ====== Parent metrics ====== */
function pushMetrics(reachPct=0, doseTum=0, tox=0, ctrlPct=85){
  window.parent?.postMessage({
    type:"NANO_METRICS",
    payload:{
      reachPct: reachPct,
      doseTumor: doseTum,
      toxicity: tox,
      tumorPct: ctrlPct
    }
  },"*");
}

/* ====== Reset / Spawn / Start ====== */
function resetAll(){
  bots=[]; hm.fill(0);
  total=0; arrived=0; aucTum=0; aucSano=0; ctrl=85;
  mode="idle"; injT=0; needle={x:200,y:-160,plunger:0};

  ui.status.textContent="Estado: esperando inyecciÃ³n.";
  ui.kReach.textContent="0%";
  ui.kAUCT.textContent="0.0";
  ui.kTox.textContent="0%";
  ui.kCtrl.textContent="85%";
  pushMetrics(0,0,0,85);
}

function spawn(mult=1){
  const n=Math.max(90, Math.floor(parseInt(ui.dose.value,10)*mult));
  total += n;
  for(let i=0;i<n;i++){
    bots.push({
      x: blood.x + rand(10,60),
      y: blood.y + rand(10,blood.h-10),
      vx:0,vy:0,
      drug:1.0,
      crossed:false,
      stuck:false,
      alive:true
    });
  }
}

function startInjection(){
  resetAll();
  mode="inject";
  injT=0;
  spawn(1);
  ui.status.textContent="ðŸ’‰ InyecciÃ³n IV: nanorobots entrando al vaso sanguÃ­neoâ€¦";
}

/* ====== Flow ====== */
function flowField(y){
  const center=blood.y+blood.h/2;
  const R=blood.h/2;
  const d=y-center;
  const profile=clamp(1-(d*d)/(R*R),0,1);
  return profile * parseFloat(ui.flow.value);
}

/* ====== Simulation step ====== */
function step(dt){
  const M=typeMul();

  const B = (parseFloat(ui.B.value)/100) * M.guide;
  const BBB = (parseFloat(ui.bbb.value)/100);
  const pulse = (parseFloat(ui.pulse.value)/100);
  const rel = (parseFloat(ui.rel.value)/100);
  const leak = (parseFloat(ui.leak.value)/100) * M.leak;
  const clear = (parseFloat(ui.clear.value)/100);

  // heatmap decay
  const hmDecay = clamp(0.08 + clear*0.10, 0.04, 0.28);
  for(let k=0;k<hm.length;k++) hm[k] *= (1-hmDecay*dt);

  // elimination chance
  const kill = clamp(clear*0.13*dt, 0, 0.10);

  for(const b of bots){
    if(!b.alive) continue;
    if(Math.random()<kill){ b.alive=false; continue; }

    // In BLOOD (before BBB)
    if(!b.crossed){
      const v = flowField(b.y);
      const brown=0.6;
      b.vx = v*3.1 + rand(-brown,brown);
      b.vy = rand(-brown,brown);

      // magnetic guidance toward BBB near tumor side
      const dx = tumor.x - b.x;
      const dy = (bbbLineY+18) - b.y;
      const dist = Math.hypot(dx,dy)+1e-6;

      const gate = clamp((b.x-(blood.x+blood.w*0.55))/(blood.w*0.45), 0, 1);
      const pull = B * gate;

      b.vx += (dx/dist)*pull*3.0;
      b.vy += (dy/dist)*pull*3.0;

      b.x += b.vx*70*dt;
      b.y += b.vy*70*dt;

      // vessel walls
      if(b.y < blood.y+6) b.y=blood.y+6;
      if(b.y > blood.y+blood.h-6) b.y=blood.y+blood.h-6;

      // recirculation
      if(b.x > blood.x + blood.w + 60){
        b.x = blood.x + rand(10,60);
        b.y = blood.y + rand(10,blood.h-10);
      }

      // BBB crossing probability
      const nearBBB = (b.y > blood.y + blood.h - 20) && (b.x > blood.x + blood.w*0.60);
      if(nearBBB){
        const pCross = clamp((0.02 + 0.28*BBB + 0.22*B) * dt * 6, 0, 0.55);
        if(Math.random() < pCross){
          b.crossed = true;
          b.y = brain.y + rand(10,40);
          b.x = clamp(b.x + rand(-10,10), brain.x+10, brain.x+brain.w-10);
        }
      }

      // systemic leak
      if(b.drug>0){
        const out = Math.min(b.drug, leak*0.020);
        b.drug -= out;
        aucSano += out;
      }
      continue;
    }

    // In BRAIN: move toward tumor
    const brown=0.55;
    const dx=tumor.x-b.x, dy=tumor.y-b.y;
    const dist=Math.hypot(dx,dy)+1e-6;

    const guideBrain = (0.6 + 1.2*B) * 0.8;
    b.vx = (dx/dist)*guideBrain + rand(-brown,brown);
    b.vy = (dy/dist)*guideBrain + rand(-brown,brown);

    b.x += b.vx*55*dt;
    b.y += b.vy*55*dt;

    b.x = clamp(b.x, brain.x+8, brain.x+brain.w-8);
    b.y = clamp(b.y, brain.y+8, brain.y+brain.h-8);

    // Tumor interaction
    const inTum = Math.hypot(b.x-tumor.x, b.y-tumor.y) < tumor.r;

    if(inTum && !b.stuck){
      b.stuck = true;
      arrived++;
    }

    if(inTum && b.drug>0){
      // pulses gate
      const pulseGate = (Math.sin(performance.now()/520) * 0.5 + 0.5); // 0..1
      const pulseOn = (pulseGate < pulse);

      if(pulseOn){
        const relRate = 0.010 + 0.050*rel;
        const d = Math.min(b.drug, relRate*2.4);
        b.drug -= d;
        aucTum += d;

        const {i,j}=hmCell(b.x,b.y);
        const cell=(tumor.r*2)/HM;
        const cx=(tumor.x-tumor.r)+(j+0.5)*cell;
        const cy=(tumor.y-tumor.r)+(i+0.5)*cell;
        if((cx-tumor.x)**2 + (cy-tumor.y)**2 <= tumor.r*tumor.r){
          hm[hidx(i,j)] += d*2.4;
        }
      }
    }

    // small brain leak
    if(b.drug>0){
      const out = Math.min(b.drug, leak*0.010);
      b.drug -= out;
      aucSano += out;
    }
  }

  // KPIs
  const reachPct = total>0 ? (arrived/total)*100 : 0;
  const tox = clamp((aucSano/Math.max(1,total))*6000, 0, 100);

  const benefit = clamp(aucTum*0.035, 0, 70);
  const harm = clamp(tox*0.35, 0, 50);
  ctrl = clamp(35 + benefit - harm, 0, 100);

  ui.kReach.textContent = Math.round(reachPct)+"%";
  ui.kAUCT.textContent = aucTum.toFixed(1);
  ui.kTox.textContent = Math.round(tox)+"%";
  ui.kCtrl.textContent = Math.round(ctrl)+"%";

  // Send to parent/index
  pushMetrics(reachPct, aucTum, tox, ctrl);
}

/* ====== Drawing helpers ====== */
function roundRect(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

function drawHeatmap(){
  const cell=(tumor.r*2)/HM;
  const maxV=0.9;
  for(let i=0;i<HM;i++){
    for(let j=0;j<HM;j++){
      const v=hm[hidx(i,j)];
      if(v<0.002) continue;
      const x=(tumor.x-tumor.r)+j*cell;
      const y=(tumor.y-tumor.r)+i*cell;
      const cx=x+cell/2, cy=y+cell/2;
      if((cx-tumor.x)**2 + (cy-tumor.y)**2 > tumor.r*tumor.r) continue;
      const a=clamp(v/maxV,0,1);
      ctx.fillStyle=`rgba(${Math.round(255*a)},${Math.round(210*a)},${Math.round(70*a)},${0.30*a})`;
      ctx.fillRect(x,y,cell,cell);
    }
  }
}

function drawNeedle(){
  const x=needle.x, y=needle.y;

  // syringe body
  ctx.fillStyle="rgba(255,255,255,.85)";
  ctx.fillRect(x-20, y-30, 85, 24);

  // plunger
  ctx.fillStyle="rgba(233,236,255,.85)";
  ctx.fillRect(x-18 + needle.plunger*46, y-28, 10, 20);

  // tube
  ctx.fillStyle="rgba(255,255,255,.92)";
  ctx.fillRect(x+14, y-8, 14, 150);

  // grip
  ctx.fillStyle="rgba(255,255,255,.70)";
  ctx.fillRect(x, y+40, 44, 18);

  // needle tip
  ctx.fillStyle="rgba(251,191,36,.90)";
  ctx.beginPath();
  ctx.moveTo(x+21, y+138);
  ctx.lineTo(x+36, y+170);
  ctx.lineTo(x+6,  y+170);
  ctx.closePath();
  ctx.fill();

  // bolus droplet
  ctx.fillStyle="rgba(56,189,248,.88)";
  ctx.beginPath();
  ctx.arc(x+21, y+172, 7, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle="rgba(233,236,255,.85)";
  ctx.font="bold 14px Arial";
  ctx.fillText("InyecciÃ³n IV", x+60, y-10);
}

/* ====== Draw scene ====== */
function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);

  // background
  const g=ctx.createLinearGradient(0,0,0,cv.height);
  g.addColorStop(0,"#000"); g.addColorStop(1,"#020617");
  ctx.fillStyle=g; ctx.fillRect(0,0,cv.width,cv.height);

  // titles
  ctx.fillStyle="rgba(233,236,255,.92)";
  ctx.font="bold 20px Arial";
  ctx.fillText("Sangre â†’ BBB â†’ Tumor cerebral (guÃ­a magnÃ©tica + liberaciÃ³n controlada)", 18, 34);
  ctx.font="13px Arial";
  ctx.fillStyle="rgba(233,236,255,.70)";
  ctx.fillText("Azul: con fÃ¡rmaco â€¢ Amarillo: descargados â€¢ Heatmap: fÃ¡rmaco en tumor", 18, 56);

  // blood vessel
  roundRect(blood.x,blood.y,blood.w,blood.h,blood.r);
  ctx.fillStyle="rgba(148,163,184,.08)"; ctx.fill();
  ctx.strokeStyle="rgba(56,189,248,.25)"; ctx.lineWidth=2; ctx.stroke();

  // BBB line
  ctx.strokeStyle="rgba(255,255,255,.25)";
  ctx.setLineDash([8,8]);
  ctx.beginPath();
  ctx.moveTo(80, bbbLineY);
  ctx.lineTo(cv.width-80, bbbLineY);
  ctx.stroke();
  ctx.setLineDash([]);

  ctx.fillStyle="rgba(233,236,255,.75)";
  ctx.font="bold 13px Arial";
  ctx.fillText("BBB (barrera hematoencefÃ¡lica)", 90, bbbLineY-10);

  // brain area
  roundRect(brain.x,brain.y,brain.w,brain.h,brain.r);
  ctx.fillStyle="rgba(167,139,250,.07)"; ctx.fill();
  ctx.strokeStyle="rgba(167,139,250,.20)"; ctx.lineWidth=2; ctx.stroke();

  // tumor halo + heatmap
  const halo=ctx.createRadialGradient(tumor.x,tumor.y,10,tumor.x,tumor.y,tumor.r*2.3);
  halo.addColorStop(0,"rgba(167,139,250,.16)");
  halo.addColorStop(1,"rgba(167,139,250,0)");
  ctx.fillStyle=halo;
  ctx.beginPath(); ctx.arc(tumor.x,tumor.y,tumor.r*2.3,0,Math.PI*2); ctx.fill();

  drawHeatmap();

  // tumor boundary
  ctx.beginPath(); ctx.arc(tumor.x,tumor.y,tumor.r,0,Math.PI*2);
  ctx.fillStyle="rgba(167,139,250,.12)"; ctx.fill();
  ctx.lineWidth=6;
  ctx.strokeStyle="rgba(56,189,248,.35)";
  ctx.stroke();

  // tumor label
  ctx.fillStyle="rgba(233,236,255,.90)";
  ctx.font="bold 14px Arial";
  ctx.fillText("Tumor objetivo", tumor.x - 55, tumor.y - tumor.r - 14);

  // labels for zones
  ctx.fillStyle="rgba(233,236,255,.65)";
  ctx.font="bold 12px Arial";
  ctx.fillText("SANGRE", blood.x+14, blood.y+20);
  ctx.fillText("CEREBRO", brain.x+14, brain.y+20);

  // bots
  for(const b of bots){
    if(!b.alive) continue;

    const isEmpty = b.drug <= 0.01;
    const inBlood = !b.crossed;

    const r = inBlood ? 3.1 : 3.5;
    ctx.beginPath();
    ctx.arc(b.x,b.y,r,0,Math.PI*2);

    // color: blue = with drug, yellow = discharged
    ctx.fillStyle = isEmpty ? "rgba(251,191,36,.85)" : "rgba(56,189,248,.85)";
    ctx.fill();

    // tiny glow
    ctx.shadowBlur = isEmpty ? 10 : 12;
    ctx.shadowColor = isEmpty ? "rgba(251,191,36,.35)" : "rgba(56,189,248,.35)";
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  // injection animation overlay
  if(mode==="inject"){
    drawNeedle();
  }

  // subtle guide arrow (blood -> BBB -> tumor)
  ctx.strokeStyle="rgba(56,189,248,.18)";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(blood.x+blood.w*0.70, blood.y+blood.h*0.40);
  ctx.lineTo(blood.x+blood.w*0.92, blood.y+blood.h*0.85);
  ctx.lineTo(tumor.x-tumor.r*0.6, bbbLineY+30);
  ctx.lineTo(tumor.x-tumor.r*0.25, tumor.y-tumor.r*0.3);
  ctx.stroke();

  ctx.fillStyle="rgba(233,236,255,.55)";
  ctx.font="12px Arial";
  ctx.fillText("Ruta guiada", blood.x+blood.w*0.72, blood.y+blood.h*0.38);
}

/* ====== Loop ====== */
let last = performance.now();

function loop(now){
  const dt = clamp((now-last)/1000, 0, 0.033);
  last = now;

  if(mode==="inject"){
    injT += dt;

    // animate needle down + plunger
    needle.y = -160 + clamp(injT*330, 0, 320);
    needle.plunger = clamp((injT-0.35)*1.2, 0, 1);

    // after short injection, start sim
    if(injT > 1.25){
      mode = "sim";
      ui.status.textContent="ðŸ§­ SimulaciÃ³n en marcha: guiando â†’ cruzando BBB â†’ liberando en tumorâ€¦";
    }
  }

  if(mode==="sim"){
    step(dt);
  }

  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ====== Buttons ====== */
ui.inject.addEventListener("click", ()=>{
  startInjection();
});

ui.boost.addEventListener("click", ()=>{
  if(mode==="idle"){
    // allow boost to start too
    startInjection();
    return;
  }
  // add more bots without resetting
  spawn(0.45);
  ui.status.textContent="âž• Refuerzo aplicado: sube la dosis circulante.";
});

ui.reset.addEventListener("click", ()=>{
  resetAll();
});

// start clean
resetAll();
</script>

</body>
</html>
