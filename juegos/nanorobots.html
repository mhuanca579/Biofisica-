<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Retina - Simulación Neuroprotectora</title>
<style>
body{margin:0;background:#060b18;color:#e8f0ff;font-family:Arial}
#ui{position:absolute;left:10px;top:10px;width:300px;background:#0f172a;padding:12px;border-radius:12px}
label{font-size:12px}
canvas{display:block;margin-left:320px;background:#000;border-left:3px solid #38bdf8}
button,select,input{width:100%;margin-top:6px}
</style>
</head>
<body>

<div id="ui">
<h3>Gotas neuroprotectoras</h3>
<label>Vehículo</label>
<select id="tipo">
<option value="1">Liposoma</option>
<option value="1.2">Magnético</option>
<option value="1.5">Anticuerpo dirigido</option>
</select>

<label>Cantidad aplicada</label>
<input type="range" id="cantidad" min="10" max="200" value="80">

<label>Direccionamiento</label>
<input type="range" id="target" min="0" max="100" value="60">

<label>Liberación fuera del objetivo</label>
<input type="range" id="libre" min="0" max="100" value="20">

<button onclick="inyectar()">Inyectar gotas</button>
</div>

<canvas id="cv" width="900" height="500"></canvas>

<script>
const cv=document.getElementById("cv"),ctx=cv.getContext("2d");
let bots=[],tumor={x:650,y:250,r:70},size=100;

function inyectar(){
 bots=[];
 const n=+cantidad.value;
 for(let i=0;i<n;i++){
  bots.push({x:50,y:250+Math.random()*80-40,v:1+Math.random(),hit:false});
 }
}

function loop(){
 ctx.clearRect(0,0,cv.width,cv.height);
 ctx.strokeStyle="#38bdf8";
 ctx.beginPath();ctx.arc(tumor.x,tumor.y,tumor.r,0,6.28);ctx.stroke();

 let hit=0;
 bots.forEach(b=>{
  b.x+=b.v*(+tipo.value);
  if(Math.hypot(b.x-tumor.x,b.y-tumor.y)<tumor.r) b.hit=true;
  ctx.fillStyle=b.hit?"#22c55e":"#60a5fa";
  ctx.beginPath();ctx.arc(b.x,b.y,3,0,6.28);ctx.fill();
  if(b.hit) hit++;
 });

 size=Math.max(10,size-hit*0.02*(target.value/100));
 ctx.fillStyle="#22c55e";
 ctx.fillRect(10,460,size,10);

 window.parent.postMessage({
  type:"NANO_METRICS",
  payload:{
   reachPct:hit/bots.length*100||0,
   doseTumor:hit,
   toxicity:libre.value,
   tumorPct:size
  }
 },"*");

 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
